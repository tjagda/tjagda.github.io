<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>J+Z Wedding Reception Seating</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.jade.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.1.0"></script>
  <style>
    svg {
      width: 95%;
      height: 95%;
    }

    path {
      fill: none;
      stroke: #015234;
      stroke-width: 4.0;
      stroke-dasharray: '0';
      stroke-opacity: 1;
    }

    .tables {
      cursor: pointer;
      fill: #015234;
      fill-opacity: .01;
      stroke: #015234;
      stroke-width: 4.4;
      stroke-opacity: 1;
    }

    article {
      cursor: pointer;
    }

    .faded {
      color: grey;
      font-style: italic;
    }

    .selected {
      background-color: #39F1A6;
      transition: background-color 0.5s ease;
    }

    #twoCol {
      display: flex;
      justify-content: space-between;
    }

    #nameDropdown {
      width: 90%;

    }

    #map {
      display: flex;
      justify-content: center;
      width: 100%;
    }
  </style>
  <script type="module">
    //              _                 _   _
    //   __ _ _ __ (_)_ __ ___   __ _| |_(_) ___  _ __  ___
    //  / _` | '_ \| | '_ ` _ \ / _` | __| |/ _ \| '_ \/ __|
    // | (_| | | | | | | | | | | (_| | |_| | (_) | | | \__ \
    //  \__,_|_| |_|_|_| |_| |_|\__,_|\__|_|\___/|_| |_|___/

    // Import anime.js
    import {animate, createTimeline, svg, text, stagger} from 'https://cdn.jsdelivr.net/npm/animejs/+esm';

    // Animations: Title
    const {chars} = text.splitText('#title-anim', {words: false, chars: true});
    //animate(chars, {
    //  // Property keyframes
    //  y: [
    //    {to: '-3.5rem', ease: 'outExpo', duration: 600},
    //    {to: 0, ease: 'outBounce', duration: 800, delay: 100}
    //  ],
    //  // Property specific parameters
    //  rotate: {
    //    from: '-1turn',
    //    delay: 0
    //  },
    //  delay: stagger(50),
    //  ease: 'inOutCirc',
    //  loopDelay: 2000,
    //  loop: true
    //});

    // Animations: Seating Paths
    const seatingPaths = [];
    for (let i = 0; i < 13; i++) {
      seatingPaths.push(
        createTimeline({autoplay: false})
          .add(
            svg.createDrawable("#path" + i),
            {
              draw: ['0 0', '0 1'],
              ease: 'inOutQuad',
              duration: 800,
              delay: stagger(100),
              loopDelay: 5000,
              loop: true
            },
            0
          ).add(
            svg.createDrawable("#table" + i),
            {
              draw: ['0 0', '0 1'],
              ease: 'inOutQuad',
              duration: 800,
              loopDelay: 5000,
              loop: true
            },
            550
          )
      );
    }
    console.log(seatingPaths);


    //                          _
    //  ___  ___  __ _ _ __ ___| |__
    // / __|/ _ \/ _` | '__/ __| '_ \
    // \__ \  __/ (_| | | | (__| | | |
    // |___/\___|\__,_|_|  \___|_| |_|

    // List of people
    // TODO: change into it's own file?
    const list = [
      {"name": "Josh Agda", "table": "0"},
      {"name": "Zemirah Agda", "table": "0"},
      {"name": "Noel Garcia", "table": "1"},
      {"name": "Zenaida Garcia", "table": "1"},
      {"name": "Zigrid Garcia", "table": "1"},
      {"name": "Zarah Garcia", "table": "1"},
      {"name": "JN Garcia", "table": "1"},
      {"name": "Jade Marcelo", "table": "1"},
      {"name": "Nicholas Klassen", "table": "1"},
      {"name": "Hannah Abogado", "table": "1"},
      {"name": "Andy Huynh", "table": "2"},
      {"name": "My Huynh", "table": "2"},
      {"name": "Mike Mackneer", "table": "2"},
      {"name": "Brian Magnus", "table": "2"},
      {"name": "Lynette Magnus", "table": "2"},
      {"name": "Jonathan Saroma", "table": "2"},
      {"name": "Flocyn Saroma", "table": "2"},
      {"name": "Romeo Agda Sr.", "table": "3"},
      {"name": "Jael Agda", "table": "3"},
      {"name": "Romeo Agda Jr.", "table": "3"},
      {"name": "John Agda", "table": "3"},
      {"name": "Jireh Agda", "table": "3"},
      {"name": "Alice Amasol", "table": "3"},
      {"name": "Anna Amasol", "table": "3"},
      {"name": "Paul Meneses", "table": "3"},
      {"name": "Teresita Uy ", "table": "4"},
      {"name": "Joselito Uy", "table": "4"},
      {"name": "Angelo Uy", "table": "4"},
      {"name": "Ethzel Uy", "table": "4"},
      {"name": "Aida Vilbar ", "table": "4"},
      {"name": "Danny Vilbar", "table": "4"},
      {"name": "Raya Vilbar", "table": "4"},
      {"name": "Edna Vilbar", "table": "4"},
      {"name": "Abby Uy ", "table": "5"},
      {"name": "Josue Fuentes Parada", "table": "5"},
      {"name": "Eli Foell ", "table": "5"},
      {"name": "Joanna Schmidt ", "table": "5"},
      {"name": "Shawn Schmidt ", "table": "5"},
      {"name": "Blake Schmidt ", "table": "5"},
      {"name": "Alyssa Uy", "table": "5"},
      {"name": "Judy Iv", "table": "6"},
      {"name": "Iris Ionico", "table": "6"},
      {"name": "Eric Ionico", "table": "6"},
      {"name": "Milo Ionico", "table": "6"},
      {"name": "Michael Nguyen", "table": "6"},
      {"name": "Ritzael Lacson", "table": "6"},
      {"name": "Rhazel Lacson", "table": "6"},
      {"name": "Julia De Guzman", "table": "6"},
      {"name": "David Huynh", "table": "7"},
      {"name": "Abram Ordona", "table": "7"},
      {"name": "Daniel Santos", "table": "7"},
      {"name": "Danny Lai", "table": "7"},
      {"name": "Raymond Than", "table": "7"},
      {"name": "Tung Lam", "table": "7"},
      {"name": "Dat Pham", "table": "7"},
      {"name": "Curtis McGoey", "table": "7"},
      {"name": "Hannah Huynh", "table": "8"},
      {"name": "Lisa Huynh", "table": "8"},
      {"name": "Michelle Huynh", "table": "8"},
      {"name": "Alison Huynh", "table": "8"},
      {"name": "Ann Huynh", "table": "8"},
      {"name": "Alice Uyen", "table": "8"},
      {"name": "Abby Uyen", "table": "8"},
      {"name": "Princess Saroma", "table": "8"},
      {"name": "Nicole Saroma", "table": "9"},
      {"name": "Sophia Edes", "table": "9"},
      {"name": "Zoe Ulat", "table": "9"},
      {"name": "Connor Martinez", "table": "9"},
      {"name": "Ashley Ulat", "table": "9"},
      {"name": "Janelle Balauag", "table": "9"},
      {"name": "Jake Balauag", "table": "9"},
      {"name": "Jam Ordona", "table": "9"},
      {"name": "Helen Cables", "table": "10"},
      {"name": "Julius Cables", "table": "10"},
      {"name": "Fely Varila", "table": "10"},
      {"name": "Neil Ibanez", "table": "10"},
      {"name": "Jotham Inapan", "table": "10"},
      {"name": "Ardeth Inapan", "table": "10"},
      {"name": "Yeeshu Inapan", "table": "10"},
      {"name": "Sonia Castro", "table": "10"},
      {"name": "Kurt De Leon", "table": "11"},
      {"name": "Fatima Buela", "table": "11"},
      {"name": "RJ Inacay", "table": "11"},
      {"name": "Roy Morales", "table": "11"},
      {"name": "Raphael Lacson", "table": "11"},
      {"name": "Brynley Teri ", "table": "12"},
      {"name": "Ariana del Mundo", "table": "12"},
      {"name": "Alex del Mundo", "table": "12"},
      {"name": "Ida Ordas", "table": "12"},
      {"name": "Stephanie Quintano", "table": "12"},
      {"name": "Angelo Quintano", "table": "12"}
    ]

    // Fuse search setup
    const options = {
      includeScore: true,
      keys: ["name"]
    }
    const fuse = new Fuse(list, options);

    // Elements
    const searchInput = document.getElementById("search");
    const nameDropdownDiv = document.getElementById("nameDropdown");
    const tableBoxes = document.getElementsByClassName("tables");

    function addNameDropdownCard(guestName, guestTable) {
      let card = document.createElement("article");
      card.innerHTML = `${guestName} <span class="faded">Table&nbsp;${guestTable}</span>`;

      // Start seating animation
      card.addEventListener("click", function () {
        // Remove previous highlights and add new highlight
        let oldSelected = document.getElementsByClassName("selected");
        Array.from(oldSelected).forEach((element) => element.classList.remove("selected"));
        this.classList.add("selected");

        // Start new seating animation
        if (guestTable < seatingPaths.length) {
          seatingPaths.forEach((anim) => anim.began && anim.revert());
          seatingPaths[guestTable].play();
        }

        // Restart clearing timer
        restartTimeout();
      });
      nameDropdownDiv.append(card);
    }

    function clearDropdownCards() {
      nameDropdownDiv.innerHTML = "";
    }


    //  _   _                            _   
    // | |_(_)_ __ ___   ___  ___  _   _| |_ 
    // | __| | '_ ` _ \ / _ \/ _ \| | | | __|
    // | |_| | | | | | |  __/ (_) | |_| | |_ 
    //  \__|_|_| |_| |_|\___|\___/ \__,_|\__|
    var timeoutHandle = null;

    function restartTimeout() {
      if (!!timeoutHandle) {
        window.clearTimeout(timeoutHandle);
      }

      // Clear elements
      timeoutHandle = window.setTimeout(() => {
        searchInput.value = "";
        seatingPaths.forEach((anim) => anim.began && anim.revert());
        clearDropdownCards();
      }, 15000);
    }


    //              _                 _ 
    //   ___  _ __ | | ___   __ _  __| |
    //  / _ \| '_ \| |/ _ \ / _` |/ _` |
    // | (_) | | | | | (_) | (_| | (_| |
    //  \___/|_| |_|_|\___/ \__,_|\__,_|

    document.addEventListener('DOMContentLoaded', async function () {
      // Input function
      searchInput.addEventListener("input", function () {
        const limit = 7;
        let result = fuse.search(this.value);

        // Revert any seating animations
        seatingPaths.forEach((anim) => anim.began && anim.revert());

        // Only get the top hits
        clearDropdownCards();
        let topHits = result.slice(0, limit).forEach((hit) => {
          addNameDropdownCard(hit["item"]["name"], hit["item"]["table"]);
        });

        // Restart clearing timer
        restartTimeout();
      });

      // Add event listener for each table to show table guests and start animation
      Array.from(tableBoxes).forEach((element) => {
        let guestTable = element.id.slice(5)

        element.addEventListener("click", () => {
          // TODO: Memoize?
          let tableGuests = list.filter((guest) => guest['table'] == guestTable);

          clearDropdownCards();
          tableGuests.forEach((guest) => addNameDropdownCard(guest["name"], guest["table"]));

          if (guestTable < seatingPaths.length) {
            seatingPaths.forEach((anim) => anim.began && anim.revert());
            seatingPaths[guestTable].play();
          }

          // Restart clearing timer
          restartTimeout();
        });
      });
    });
  </script>
</head>

<body>
  <main class="container">
    <div id="title-anim" class="large centered row">
      <h1>Josh and Zemirah's Wedding Reception</h1>
    </div>
    <div id="search-bar">
      <input type="search" id="search" name="search" placeholder="Search" aria-describedby="search-helper">
      <small id="search-helper">
        <u>Enter your name</u> to find your table, or <u>tap on a table</u> to see table guests!
      </small>
    </div>

    <div id="twoCol">
      <div id="nameDropdown">
      </div>

      <div id="map">
        <svg viewBox="0 0 219.840 407.040">
          <image href="./floorplanv4.png" x="0" y="0" width="219.840" height="407.040" />

          <!-- tables -->
          <rect id="table0" class="tables" width="42.295578" height="15.362844" x="85.8209" y="38.053413" />
          <path id="table1" class="tables"
            d="m 54.246593,67.331836 c -7.120911,-0.204326 -12.302277,5.197916 -12.257932,12.576143 0.04704,7.82664 6.591935,12.188227 12.384974,12.196893 6.720732,0.01005 12.132255,-5.342049 12.258548,-12.576766 0.120486,-6.902074 -5.476357,-11.998018 -12.38559,-12.19627 z" />
          <path id="table2" class="tables"
            d="m 106.9948,112.88898 c -7.120907,-0.20432 -12.302273,5.19792 -12.257928,12.57615 0.04704,7.82664 6.591938,12.18822 12.384968,12.19689 6.72074,0.0101 12.13226,-5.34205 12.25855,-12.57676 0.12049,-6.90208 -5.47635,-11.99803 -12.38559,-12.19628 z" />
          <path id="table3" class="tables"
            d="m 162.49937,68.008833 c -7.12091,-0.204326 -12.30227,5.197916 -12.25793,12.576143 0.047,7.82664 6.59194,12.188227 12.38497,12.196893 6.72074,0.01005 12.13226,-5.342049 12.25855,-12.576766 0.12049,-6.902074 -5.47635,-11.998018 -12.38559,-12.19627 z" />
          <rect id="table4" class="tables" width="42.295578" height="15.362844" x="116.38371" y="-63.355305"
            transform="rotate(90)" />
          <rect id="table5" class="tables" width="42.295578" height="15.362844" x="158.71712" y="-63.330036"
            transform="rotate(90)" />
          <rect id="table6" class="tables" width="42.295578" height="15.362844" x="199.27672" y="-63.540276"
            transform="rotate(90)" />
          <rect id="table7" class="tables" width="42.295578" height="15.362844" x="158.20563" y="-115.76582"
            transform="rotate(90)" />
          <rect id="table8" class="tables" width="42.295578" height="15.362844" x="200.53902" y="-115.74055"
            transform="rotate(90)" />
          <rect id="table9" class="tables" width="42.295578" height="15.362844" x="241.09862" y="-115.95079"
            transform="rotate(90)" />
          <rect id="table10" class="tables" width="42.295578" height="15.362844" x="117.85863" y="-168.36287"
            transform="rotate(90)" />
          <rect id="table11" class="tables" width="42.295578" height="15.362844" x="160.19205" y="-168.51726"
            transform="rotate(90)" />
          <rect id="table12" class="tables" width="42.295578" height="15.362844" x="201.47031" y="-168.54785"
            transform="rotate(90)" />

          <!-- paths -->
          <path
            d="m 89.831695,359.32678 c 0,0 28.066335,-30.58168 27.786465,-42.37402 C 117.09639,294.9682 59.740273,302.24639 75.246099,260.87582 92.98133,213.55704 92.915556,171.29811 79.72581,123.70877 72.408151,97.306249 76.588723,78.181011 112.10833,94.290422 c 8.96355,4.065294 -5.7476,-33.923523 -5.7476,-33.923523"
            id="path0" />
          <path
            d="m 92.706309,360.76409 c 0,0 25.383131,-23.17632 23.934291,-38.10583 -1.87209,-19.29098 -33.430425,-24.07348 -39.816747,-42.37269 -13.081069,-37.4822 6.886263,-89.7938 9.844439,-118.69015 1.606477,-15.69253 -1.214844,-32.1567 -7.117166,-46.7854 C 77.27159,109.16027 68.990742,99.892844 68.990742,99.892844"
            id="path1" />
          <path
            d="m 91.269002,362.92005 c 0,0 17.325258,-0.93412 25.582778,-22.31141 C 122.66554,325.55781 92.255314,297.93403 86.359342,280.91763 75.281824,248.94674 76.115286,217.38982 80.9619,186.10902 83.158927,171.92906 96.299576,145.88666 96.299576,145.88666"
            id="path2" />
          <path
            d="m 91.269002,361.48274 c 0,0 3.873439,-31.88275 29.603778,-36.46687 35.40063,-6.30698 17.5281,-81.5467 12.56696,-117.93474 -3.7484,-27.49306 -17.01126,-51.67131 2.18818,-83.24222 4.61573,-7.58996 14.57068,-21.7901 14.57068,-21.7901"
            id="path3" />
          <path
            d="m 91.987655,362.92005 c 0,0 -7.831977,-16.93821 9.837925,-38.07543 C 111.95195,312.73117 94.269105,302.35696 79.047485,280.27537 58.669086,250.71299 99.954608,192.95271 85.19041,164.48333 81.520797,157.40732 73.302663,150.1986 73.302663,150.1986"
            id="path4" />
          <path
            d="m 91.987655,360.04543 c 0,0 22.547225,-24.994 20.705685,-39.84958 C 110.34183,301.22637 80.411146,298.27272 74.629245,277.30692 67.069499,249.89448 91.333986,236.45535 89.110497,214.2173 88.427348,207.38484 71.865356,189.72454 71.865356,189.72454"
            id="path5" />
          <path
            d="m 91.987655,362.92005 c 0,0 20.174335,-19.79881 24.759715,-31.09593 10.04861,-24.75701 -60.042496,-41.73048 -36.318015,-57.77304 9.950565,-6.7286 -11.438614,-27.55291 -11.438614,-27.55291"
            id="path6" />
          <path
            d="m 91.987655,362.20139 c 0,0 5.495321,-35.47677 15.662775,-49.46945 7.33772,-10.09833 11.93657,-12.63091 30.46349,-21.77938 22.46668,-11.09389 -22.20595,-43.61431 -5.62604,-56.21613 15.45292,-11.74524 -8.87946,-34.2321 -8.87946,-34.2321"
            id="path7" />
          <path
            d="m 91.987655,360.76409 c 0,0 33.745215,-9.13764 18.851795,-38.25517 -9.89928,-19.35367 21.49789,-29.50107 36.3228,-36.33668 21.33244,-9.83617 -19.24192,-46.14195 -19.24192,-46.14195"
            id="path8" />
          <path
            d="m 91.987655,360.76409 c 0,0 -17.978362,-17.64689 -13.077037,-26.02872 8.78491,-15.02321 48.299882,14.52095 52.152072,-2.45056 2.40451,-10.5935 -23.50838,-5.89284 -28.70272,-15.43343 -3.665356,-6.73227 1.84479,-22.92208 1.84479,-22.92208"
            id="path9" />
          <path
            d="m 90.550348,357.17082 c 0,0 36.947962,-25.22494 44.941912,-44.81157 10.8006,-26.46343 7.84924,-73.72227 -1.01648,-85.74183 -5.27861,-7.15639 -10.41811,-26.05579 1.47897,-38.66017 10.03427,-10.63083 -1.28893,-11.60529 -7.40156,-24.54724 -2.28079,-4.829 14.45889,-12.49276 14.45889,-12.49276"
            id="path10" />
          <path
            d="m 91.269002,362.20139 c 0,0 46.766398,-30.14326 54.319918,-54.70584 8.86132,-28.81527 -22.51638,-59.32386 -16.65166,-88.89492 1.84467,-9.30119 15.51211,-23.84552 15.51211,-23.84552"
            id="path11" />
          <path
            d="m 91.987655,360.76409 c 0,0 24.802225,-10.00691 25.264985,-18.08345 0.56942,-9.93806 -22.782447,-18.80062 -17.581133,-24.92324 15.347753,-18.06632 54.702873,-3.43334 67.064913,-23.66018 7.46702,-12.21758 -5.75802,-42.56848 -5.75802,-42.56848"
            id="path12" />

        </svg>
      </div>
    </div>
  </main>
</body>

</html>
